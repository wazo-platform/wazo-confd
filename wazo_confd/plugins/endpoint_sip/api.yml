paths:
  /endpoints/sip:
    get:
      operationId: list_endpoints_sip
      summary: List SIP endpoints
      description: |
        **Required ACL:** `confd.endpoints.sip.read`
        List all SIP configurations, each individual configuration includes only fields that it
        defines. Inherited fields from the parents or default values are not returned here.
      tags:
        - endpoints
        - sip
      parameters:
        - $ref: '#/parameters/tenantuuid'
        - $ref: '#/parameters/recurse'
        - $ref: '#/parameters/order'
        - $ref: '#/parameters/direction'
        - $ref: '#/parameters/limit'
        - $ref: '#/parameters/offset'
        - $ref: '#/parameters/search'
      responses:
        '200':
          description: SIP endpoint list
          schema:
            $ref: '#/definitions/EndpointSIPItems'
    post:
      operationId: create_endpoint_sip
      summary: Create a SIP endpoint
      description: |
        **Required ACL:** `confd.endpoints.sip.create`
        Create a new SIP endpoint. This endpoint can inherit from other endpoints, only modify
        fields that have to be modified.
      tags:
        - endpoints
        - sip
      parameters:
        - $ref: '#/parameters/tenantuuid'
        - name: body
          in: body
          description: SIP Endpoint to create
          required: true
          schema:
            $ref: '#/definitions/EndpointSIP'
      responses:
        '201':
          description: SIP endpoint created
          schema:
            $ref: '#/definitions/EndpointSIP'
        '400':
          $ref: '#/responses/CreateError'
  /endpoints/sip/{sip_uuid}:
    get:
      operationId: get_endpoint_sip
      summary: Get SIP Endpoint
      description: '**Required ACL:** `confd.endpoints.sip.{sip_uuid}.read`'
      tags:
        - sip
        - endpoints
      parameters:
        - $ref: '#/parameters/tenantuuid'
        - $ref: '#/parameters/sipuuid'
      responses:
        '200':
          description: SIP Endpoint
          schema:
            $ref: '#/definitions/EndpointSIP'
        '404':
          $ref: '#/responses/NotFoundError'
    put:
      operationId: update_endpoint_sip
      summary: Update SIP Endpoint
      description: '**Required ACL:** `confd.endpoints.sip.{sip_uuid}.update`'
      tags:
        - endpoints
        - sip
      parameters:
        - $ref: '#/parameters/tenantuuid'
        - $ref: '#/parameters/sipuuid'
        - name: body
          in: body
          required: true
          schema:
            $ref: '#/definitions/EndpointSIP'
      responses:
        '204':
          $ref: '#/responses/ResourceUpdated'
        '400':
          $ref: '#/responses/UpdateError'
        '404':
          $ref: '#/responses/NotFoundError'
    delete:
      operationId: delete_endpoint_sip
      summary: Delete SIP Endpoint
      description: '**Required ACL:** `confd.endpoints.sip.{sip_uuid}.delete`'
      tags:
        - endpoints
        - sip
      parameters:
      - $ref: '#/parameters/tenantuuid'
      - $ref: '#/parameters/sipuuid'
      responses:
        '204':
          $ref: '#/responses/ResourceDeleted'
        '400':
          $ref: '#/responses/DeleteError'
        '404':
          $ref: '#/responses/NotFoundError'

parameters:
  sipuuid:
    required: true
    type: string
    name: sip_uuid
    in: path

definitions:
  EndpointSipRelationBase:
    properties:
      uuid:
        type: string
        description: SIP Endpoint UUID
        readOnly: true
      name:
        type: string
        description: The name of the SIP endpoint
        default: username if specified or autogenerated
      username:
        type: string
        description: SIP username
        default: autogenerated
  SIPSectionOptions:
    properties:
      option:
        type: string
        description: The name of the PJSIP option as seen in an Asterisk configuration file
      value:
        type: string
        description: The value for this configuration option
  SIPAORSectionOptions:
    title: PJSIP AOR Section Options
    allOf:
      - $ref: '#/definitions/SIPSectionOptions'
  SIPAuthSectionOptions:
    title: PJSIP Auth Section Options
    allOf:
      - $ref: '#/definitions/SIPSectionOptions'
  SIPEndpointSectionOptions:
    title: SIP Endpoint Section Options
    allOf:
      - $ref: '#/definitions/SIPSectionOptions'
  SIPIdentifySectionOptions:
    title: PJSIP Identify Section Options
    allOf:
      - $ref: '#/definitions/SIPSectionOptions'
  SIPRegistrationSectionOptions:
    title: PJSIP Registration Section Options
    allOf:
      - $ref: '#/definitions/SIPSectionOptions'
  EndpointSIPRelation:
    properties:
      uuid:
        type: string
        description: The UUID of this resource
    required:
      - uuid
  EndpointSIP:
    title: SIP Endpoint
    properties:
      uuid:
        type: string
        description: The UUID of this resource
        readOnly: true
      name:
        type: string
        description: The name of the PJSIP entity, auto-generated if missing
      display_name:
        type: string
        description: The human readable name for this configuration
      aor_section_options:
        type: array
        items:
          $ref: '#/definitions/SIPAORSectionOptions'
        description: A list of PJSIP AOR section options for this endpoint
      auth_section_options:
        type: array
        items:
          $ref: '#/definitions/SIPAuthSectionOptions'
        description: A list of PJSIP auth section options for this endpoint
      endpoint_section_options:
        type: array
        items:
          $ref: '#/definitions/SIPEndpointSectionOptions'
        description: A list of PJSIP endpoint section options for this endpoint
      identify_section_options:
        type: array
        items:
          $ref: '#/definitions/SIPIdentifySectionOptions'
        description: A list of PJSIP identify section options for this endpoint
      registration_section_options:
        type: array
        items:
          $ref: '#/definitions/SIPRegistrationSectionOptions'
        description: A list of PJSIP registration section options for this endpoint
      registration_outbound_auth_section_options:
        type: array
        items:
          $ref: '#/definitions/SIPAuthSectionOptions'
        description: A list of PJSIP auth section options for this endpoint
      outbound_auth_section_options:
        type: array
        items:
          $ref: '#/definitions/SIPAuthSectionOptions'
        description: A list of PJSIP auth section options for this endpoint
      transport:
        description: The transport used by this endpoint
        $ref: '#/definitions/SIPTransportRelation'
      context:
        description: The context used by this endpoint
        $ref: '#/definitions/ContextRelation'
      parents:
        type: array
        items:
          $ref: '#/definitions/EndpointSIPRelation'
        description: |
          A list of parents this endpoint will inherit from.

          The inheritance only applies to option sections. Not to the name, display_name and other fields.
          For a given list of parents [A, B, C] A will be applied over B. C will be applied over (A,B) etc.
      tenant_uuid:
        type: string
        description: The UUID of the tenant
        readOnly: true
      asterisk_id:
        type: string
        description: The ID of the Asterisk onto which this configuration applies.
      template:
        type: boolean
        description: |
          Indicate if this configuration is a template or not.

          If a configuration is a template, it's configuration will not be generated.

          Some fields are also generated only when a configuration is NOT a template, the username and password are examples.
  EndpointSIPItems:
    title: SIP Endpoints
    properties:
      items:
        items:
          $ref: '#/definitions/EndpointSIP'
        type: array
      total:
        type: integer